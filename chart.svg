<svg xmlns="http://www.w3.org/2000/svg"
     width="1600" height="900"
     viewBox="0 0 1600 900"
     font-family="system-ui, -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif">

    <!-- ========== DEFS: GRADIENTS, GLOWS ========== -->
    <defs>
        <!-- Background gradient -->
        <radialGradient id="bgRadial" cx="50%" cy="0%" r="100%">
            <stop offset="0%" stop-color="#1f2937"/>
            <stop offset="40%" stop-color="#020617"/>
            <stop offset="100%" stop-color="#020617"/>
        </radialGradient>

        <!-- Card gradient -->
        <linearGradient id="cardGradient" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#111827"/>
            <stop offset="100%" stop-color="#020617"/>
        </linearGradient>

        <!-- Digit gradient -->
        <linearGradient id="digitGradient" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#0f172a"/>
            <stop offset="100%" stop-color="#020617"/>
        </linearGradient>

        <!-- Glow for lines -->
        <filter id="lineGlow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
            <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
            </feMerge>
        </filter>

        <!-- Soft card shadow -->
        <filter id="cardShadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="0" dy="10" stdDeviation="18"
                          flood-color="#000000" flood-opacity="0.6"/>
        </filter>

        <!-- Digit shadow -->
        <filter id="digitShadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="0" dy="8" stdDeviation="12"
                          flood-color="#000000" flood-opacity="0.7"/>
        </filter>
    </defs>

    <!-- Background -->
    <rect x="0" y="0" width="1600" height="900" fill="url(#bgRadial)"/>

    <!-- Title -->
    <text x="800" y="70" text-anchor="middle"
          font-size="28" font-weight="600" fill="#e5e7eb">
        Structure and rules of EMŠO number generating.
    </text>
    <text x="800" y="98" text-anchor="middle"
          font-size="16" fill="#9ca3af">
        Digits 0–12 and the constraint groups that reference them
    </text>

    <!-- ========== CONSTRAINT BUBBLES (SINGLE ROW) ========== -->
    <!-- All at y=180..330 so connectors from y=330 down don't cross any bubbles -->

    <!-- Group positions: -->
    <!-- Range:    center x=170,  width 220 -->
    <!-- Day:      center x=390,  width 220 -->
    <!-- Month:    center x=610,  width 220 -->
    <!-- Year:     center x=830,  width 260 -->
    <!-- Middle:   center x=1090, width 220 -->
    <!-- Checksum: center x=1310, width 260 -->

    <!-- Range constraints -->
    <g filter="url(#cardShadow)">
        <rect x="60" y="180" width="220" height="150" rx="26" ry="26"
              fill="url(#cardGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="170" y="210" text-anchor="middle"
              font-size="18" font-weight="600" fill="#e5e7eb">
            Range
        </text>
        <text x="80" y="240" font-size="13" fill="#9ca3af">
            • digit-0..digit-12
        </text>
        <text x="80" y="260" font-size="13" fill="#9ca3af">
            • 0 ≤ digit-i ≤ 9
        </text>
        <text x="80" y="282" font-size="12" fill="#6b7280">
            (basic per-digit bounds)
        </text>
    </g>

    <!-- Day rules -->
    <g filter="url(#cardShadow)">
        <rect x="280" y="180" width="220" height="150" rx="26" ry="26"
              fill="url(#cardGradient)" stroke="#22c55e" stroke-width="1.5"/>
        <text x="390" y="210" text-anchor="middle"
              font-size="18" font-weight="600" fill="#e5e7eb">
            Day rules
        </text>
        <text x="295" y="240" font-size="13" fill="#9ca3af">
            d = 10·digit-0 + digit-1
        </text>
        <text x="295" y="260" font-size="13" fill="#9ca3af">
            1 ≤ d ≤ 31
        </text>
        <text x="295" y="280" font-size="12" fill="#9ca3af">
            digit-0 = 0 ⇒ digit-1 ≥ 1
        </text>
        <text x="295" y="298" font-size="12" fill="#9ca3af">
            digit-0 = 3 ⇒ digit-1 ≤ 1
        </text>
    </g>

    <!-- Month rules -->
    <g filter="url(#cardShadow)">
        <rect x="500" y="180" width="220" height="150" rx="26" ry="26"
              fill="url(#cardGradient)" stroke="#06b6d4" stroke-width="1.5"/>
        <text x="610" y="210" text-anchor="middle"
              font-size="18" font-weight="600" fill="#e5e7eb">
            Month rules
        </text>
        <text x="515" y="240" font-size="13" fill="#9ca3af">
            m = 10·digit-2 + digit-3
        </text>
        <text x="515" y="260" font-size="13" fill="#9ca3af">
            1 ≤ m ≤ 12
        </text>
        <text x="515" y="280" font-size="12" fill="#9ca3af">
            digit-2 ∈ {0,1}
        </text>
        <text x="515" y="298" font-size="12" fill="#9ca3af">
            m∈{4,6,9,11} ⇒ d ≤ 30; m=2 ⇒ d ≤ 29
        </text>
    </g>

    <!-- Year block -->
    <g filter="url(#cardShadow)">
        <rect x="700" y="180" width="260" height="150" rx="26" ry="26"
              fill="url(#cardGradient)" stroke="#a855f7" stroke-width="1.5"/>
        <text x="830" y="210" text-anchor="middle"
              font-size="18" font-weight="600" fill="#e5e7eb">
            Year block
        </text>
        <text x="715" y="240" font-size="13" fill="#9ca3af">
            y = 100·d4 + 10·d5 + d6
        </text>
        <text x="715" y="260" font-size="13" fill="#9ca3af">
            905 ≤ y ≤ 999 or 0 ≤ y ≤ 25
        </text>
        <text x="715" y="280" font-size="12" fill="#9ca3af">
            y = 25 ⇒ (m &lt; 12 ∨ (m = 12 ∧ d ≤ 10))
        </text>
    </g>

    <!-- Middle block -->
    <g filter="url(#cardShadow)">
        <rect x="950" y="180" width="220" height="150" rx="26" ry="26"
              fill="url(#cardGradient)" stroke="#22c55e" stroke-width="1.5"/>
        <text x="1060" y="210" text-anchor="middle"
              font-size="18" font-weight="600" fill="#e5e7eb">
            Middle block
        </text>
        <text x="965" y="240" font-size="13" fill="#9ca3af">
            10·digit-7 + digit-8 ≥ 10
        </text>
        <text x="965" y="260" font-size="13" fill="#9ca3af">
            digit-9 ∨ digit-10 ∨ digit-11 ≥ 1
        </text>
        <text x="965" y="280" font-size="12" fill="#6b7280">
            (serial/region-like)
        </text>
    </g>

    <!-- Checksum (A + B) -->
    <g filter="url(#cardShadow)">
        <rect x="1190" y="180" width="260" height="150" rx="26" ry="26"
              fill="url(#cardGradient)" stroke="#f97316" stroke-width="1.5"/>
        <text x="1320" y="210" text-anchor="middle"
              font-size="18" font-weight="600" fill="#e5e7eb">
            Checksum
        </text>
        <text x="1205" y="240" font-size="13" fill="#9ca3af">
            a = Σ(wᵢ·digit-i) mod 11, i=0..11
        </text>
        <text x="1205" y="260" font-size="13" fill="#9ca3af">
            constraint: a ≠ 1
        </text>
        <text x="1205" y="282" font-size="13" fill="#9ca3af">
            digit-12 = ite(a = 0, 0, 11 - a)
        </text>
    </g>

    <!-- ========== DIGIT BUBBLES (BOTTOM ROW) ========== -->
    <!-- centers: x = 120 + i*110, y center = 730, top = 700 -->

    <g filter="url(#digitShadow)">
        <!-- digit-0 -->
        <rect x="80" y="700" width="80" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="120" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-0
        </text>
        <text x="120" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..3
        </text>

        <!-- digit-1 -->
        <rect x="190" y="700" width="80" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="230" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-1
        </text>
        <text x="230" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..9
        </text>

        <!-- digit-2 -->
        <rect x="300" y="700" width="80" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="340" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-2
        </text>
        <text x="340" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..1
        </text>

        <!-- digit-3 -->
        <rect x="410" y="700" width="80" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="450" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-3
        </text>
        <text x="450" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..9
        </text>

        <!-- digit-4 -->
        <rect x="520" y="700" width="80" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="560" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-4
        </text>
        <text x="560" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..9
        </text>

        <!-- digit-5 -->
        <rect x="630" y="700" width="80" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="670" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-5
        </text>
        <text x="670" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..9
        </text>

        <!-- digit-6 -->
        <rect x="740" y="700" width="80" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="780" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-6
        </text>
        <text x="780" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..9
        </text>

        <!-- digit-7 -->
        <rect x="850" y="700" width="80" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="890" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-7
        </text>
        <text x="890" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..9
        </text>

        <!-- digit-8 -->
        <rect x="960" y="700" width="80" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="1000" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-8
        </text>
        <text x="1000" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..9
        </text>

        <!-- digit-9 -->
        <rect x="1070" y="700" width="80" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="1110" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-9
        </text>
        <text x="1110" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..9
        </text>

        <!-- digit-10 -->
        <rect x="1180" y="700" width="90" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="1225" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-10
        </text>
        <text x="1225" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..9
        </text>

        <!-- digit-11 -->
        <rect x="1290" y="700" width="90" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="1335" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-11
        </text>
        <text x="1335" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..9
        </text>

        <!-- digit-12 -->
        <rect x="1400" y="700" width="90" height="60" rx="22" ry="22"
              fill="url(#digitGradient)" stroke="#1d4ed8" stroke-width="1.5"/>
        <text x="1445" y="727" text-anchor="middle"
              font-size="15" font-weight="600" fill="#e5e7eb">digit-12
        </text>
        <text x="1445" y="747" text-anchor="middle"
              font-size="11" fill="#9ca3af">0..9
        </text>
    </g>

    <!-- ========== CONNECTIONS (NO LINES THROUGH BUBBLES) ========== -->
    <!-- All constraint bubbles end at y=330; digits start at y=700.
         So straight lines between (cx,330) and (dx,700) stay entirely in free space. -->

    <!-- Helper: centers -->
    <!-- Range:    (170,330) -->
    <!-- Day:      (390,330) -->
    <!-- Month:    (610,330) -->
    <!-- Year:     (830,330) -->
    <!-- Middle:   (1060,330) -->
    <!-- Checksum: (1320,330) -->

    <!-- Digit centers: x = rect_x + width/2, y = 700 -->

    <!-- Range → all digits (neon cyan) -->
    <g stroke="#22d3ee" stroke-width="1.8" filter="url(#lineGlow)" opacity="0.55">
        <line x1="170" y1="330" x2="120" y2="700"/>
        <line x1="170" y1="330" x2="230" y2="700"/>
        <line x1="170" y1="330" x2="340" y2="700"/>
        <line x1="170" y1="330" x2="450" y2="700"/>
        <line x1="170" y1="330" x2="560" y2="700"/>
        <line x1="170" y1="330" x2="670" y2="700"/>
        <line x1="170" y1="330" x2="780" y2="700"/>
        <line x1="170" y1="330" x2="890" y2="700"/>
        <line x1="170" y1="330" x2="1000" y2="700"/>
        <line x1="170" y1="330" x2="1110" y2="700"/>
        <line x1="170" y1="330" x2="1225" y2="700"/>
        <line x1="170" y1="330" x2="1335" y2="700"/>
        <line x1="170" y1="330" x2="1445" y2="700"/>
    </g>

    <!-- Day → digit-0, digit-1 (neon green) -->
    <g stroke="#22c55e" stroke-width="2.2" filter="url(#lineGlow)" opacity="0.9">
        <line x1="390" y1="330" x2="120" y2="700"/>
        <line x1="390" y1="330" x2="230" y2="700"/>
    </g>

    <!-- Month → digit-2, digit-3 (teal) -->
    <g stroke="#06b6d4" stroke-width="2.2" filter="url(#lineGlow)" opacity="0.9">
        <line x1="610" y1="330" x2="340" y2="700"/>
        <line x1="610" y1="330" x2="450" y2="700"/>
    </g>

    <!-- Year → digits 0..6 (purple) -->
    <g stroke="#a855f7" stroke-width="2.0" filter="url(#lineGlow)" opacity="0.85">
        <line x1="830" y1="330" x2="120" y2="700"/>
        <line x1="830" y1="330" x2="230" y2="700"/>
        <line x1="830" y1="330" x2="340" y2="700"/>
        <line x1="830" y1="330" x2="450" y2="700"/>
        <line x1="830" y1="330" x2="560" y2="700"/>
        <line x1="830" y1="330" x2="670" y2="700"/>
        <line x1="830" y1="330" x2="780" y2="700"/>
    </g>

    <!-- Middle block → digits 7..11 (green) -->
    <g stroke="#22c55e" stroke-width="2.0" filter="url(#lineGlow)" opacity="0.85">
        <line x1="1060" y1="330" x2="890" y2="700"/>
        <line x1="1060" y1="330" x2="1000" y2="700"/>
        <line x1="1060" y1="330" x2="1110" y2="700"/>
        <line x1="1060" y1="330" x2="1225" y2="700"/>
        <line x1="1060" y1="330" x2="1335" y2="700"/>
    </g>

    <!-- Checksum → digits 0..12 (orange/red) -->
    <g stroke="#f97316" stroke-width="2.0" filter="url(#lineGlow)" opacity="0.8">
        <!-- uses digits 0..11 via a -->
        <line x1="1320" y1="330" x2="120" y2="700"/>
        <line x1="1320" y1="330" x2="230" y2="700"/>
        <line x1="1320" y1="330" x2="340" y2="700"/>
        <line x1="1320" y1="330" x2="450" y2="700"/>
        <line x1="1320" y1="330" x2="560" y2="700"/>
        <line x1="1320" y1="330" x2="670" y2="700"/>
        <line x1="1320" y1="330" x2="780" y2="700"/>
        <line x1="1320" y1="330" x2="890" y2="700"/>
        <line x1="1320" y1="330" x2="1000" y2="700"/>
        <line x1="1320" y1="330" x2="1110" y2="700"/>
        <line x1="1320" y1="330" x2="1225" y2="700"/>
        <line x1="1320" y1="330" x2="1335" y2="700"/>
    </g>

    <!-- Checksum → digit-12 specifically (thicker bright line) -->
    <g stroke="#fb7185" stroke-width="2.4" filter="url(#lineGlow)" opacity="0.95">
        <line x1="1320" y1="330" x2="1445" y2="700"/>
    </g>

</svg>
